<!DOCTYPE html>
<html>
<head>
    <title>ShinobiWay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background-color: #1a1a1a; color: #e0e0e0; font-family: Arial, sans-serif; }
        button { background-color: #ff4500; color: #fff; padding: 5px 10px; margin: 5px; border: none; cursor: pointer; }
        button:hover { background-color: #ff6347; }
        #log { height: 100px; overflow-y: auto; background-color: #2f2f2f; padding: 5px; }
        #output { padding: 5px; }
        .battle-ready { color: #00ff00; }
        .genin { color: #ffd700; }
    </style>
</head>
<body>
    <div id="player-status">Shinobi [HP: <span class="player-hp">10/10</span>]</div>
    <div id="enemy-status">Enemy [HP: <span class="enemy-hp">0/0</span>]</div>
    <div id="skill-count">Skill cards: 0 | Gold: 0</div>
    <div id="output">Welcome to ShinobiWay!</div>
    <div id="start-controls">
        <button id="start-button" onclick="startGame()">Start Game</button>
    </div>
    <div id="style-controls"></div>
    <div id="jutsu-controls"></div> <!-- For jutsu selection -->
    <div id="skill-controls"></div> <!-- For skill management -->
    <div id="main-controls"></div> <!-- For main menu options -->
    <div id="log">Log started...</div>

    <script>
        let game = {
            player: { name: "Shinobi", hp: 10, maxHp: 10, skills: [], skillInventory: [], gold: 0, rank: "Student", styles: [] },
            gameState: "start",
            skillRanks: {
                "Fire Jutsu": "C-Rank", "Illusion Jutsu": "C-Rank", "Earth Jutsu": "C-Rank", 
                "Shock Field Jutsu": "C-Rank", "Substitution Jutsu": "C-Rank", "Feral Jutsu": "C-Rank"
            },
            goldValues: { "D-Rank": 5, "C-Rank": 10, "B-Rank": 50, "A-Rank": 100, "S-Rank": 500 },
            asciiArt: {
                battleStart: "üëäüí• BATTLE BEGINS! üëäüí•\nShinobi vs. Enemy!",
                "Fire Jutsu": "üî• Fire Strike!",
                "Illusion Jutsu": "üå´Ô∏è Illusion Cast!",
                "Shock Field Jutsu": "‚ö°Ô∏è Shock Field!",
                "Doom Jutsu": "üíÄ Doom Strikes!"
            },
            dotEffects: {
                "Burn Jutsu": { baseDamage: 2, duration: 3 },
                "Doom Jutsu": { baseDamage: 1, duration: 5 }
            },
            jutsuRequirements: {
                "Fire Jutsu": { styles: ["Fire"] },
                "Illusion Jutsu": { styles: ["Illusion"] },
                "Shock Field Jutsu": { styles: ["Lightning"] },
                "Substitution Jutsu": { styles: ["Earth"] },
                "Doom Jutsu": { styles: ["Illusion"] }
            }
        };

        function log(msg) {
            const el = document.getElementById('log');
            el.innerHTML += '<br>' + msg;
        }

        function startGame() {
            log('Starting game at ' + new Date().toLocaleTimeString() + '...');
            if (game.gameState === "start") {
                game.output = ["Train to earn gold and skills! Aim for 10 skills to become a Genin!"];
                document.getElementById("output").innerHTML = game.output.join("<br>");
                game.gameState = "chooseStyles";
                log('Setting up style selection...');
                setupStyleButtons();
                document.getElementById("start-button").style.display = "none";
            } else {
                log('Game already started, state: ' + game.gameState);
            }
        }

        function setupStyleButtons() {
            let controls = document.getElementById("style-controls");
            controls.innerHTML = "";
            let remainingStyles = ["Fire", "Illusion"].filter(s => !game.player.styles.includes(s));
            if (remainingStyles.length > 0) {
                remainingStyles.forEach(style => {
                    let button = document.createElement("button");
                    button.innerText = style;
                    button.onclick = function() { selectStyle(style); };
                    controls.appendChild(button);
                    log('Added ' + style + ' button');
                });
            } else {
                log('No styles left to choose.');
                game.player.styles.forEach(style => game.skillRanks[`${style} Jutsu`] = "C-Rank"); // Upgrade styles to C-Rank
                setupJutsuSelection();
            }
        }

        function selectStyle(style) {
            log('Selecting ' + style + '...');
            if (game.player.styles.length < 2 && game.gameState === "chooseStyles") {
                game.player.styles.push(style);
                log(style + ' added as a style!');
                setupStyleButtons();
                if (game.player.styles.length === 2) {
                    log('Both styles selected, proceeding to jutsu selection...');
                    document.getElementById("style-controls").innerHTML = "";
                }
            } else {
                log('Style selection invalid or complete, state: ' + game.gameState);
            }
        }

        function setupJutsuSelection() {
            game.gameState = "chooseJutsu";
            let controls = document.getElementById("jutsu-controls");
            controls.innerHTML = "";
            let availableJutsu = Object.keys(game.jutsuRequirements).filter(jutsu => 
                game.jutsuRequirements[jutsu].styles.some(s => game.player.styles.includes(s))
            );
            let randomJutsu = [];
            for (let i = 0; i < 4 && availableJutsu.length > 0; i++) {
                let index = Math.floor(Math.random() * availableJutsu.length);
                randomJutsu.push(availableJutsu.splice(index, 1)[0]);
            }
            if (randomJutsu.length > 0) {
                randomJutsu.forEach(jutsu => {
                    let button = document.createElement("button");
                    button.innerText = jutsu;
                    button.onclick = function() { selectJutsu(jutsu); };
                    controls.appendChild(button);
                    log('Added ' + jutsu + ' to selection');
                });
            } else {
                log('No jutsu available based on styles.');
                showMainScreen();
            }
        }

        function selectJutsu(jutsu) {
            log('Selecting ' + jutsu + '...');
            if (game.gameState === "chooseJutsu") {
                game.player.skills.push(jutsu);
                log(jutsu + ' added to skills!');
                document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
                document.getElementById("jutsu-controls").innerHTML = "";
                if (game.player.skills.length < 3) {
                    setupJutsuSelection(); // Allow up to 3 jutsu
                } else {
                    log('Three jutsu selected, returning to main screen...');
                    showMainScreen();
                }
            }
        }

        function showMainScreen() {
            game.gameState = "main";
            let controls = document.getElementById("main-controls");
            controls.innerHTML = "";
            ["Train", "Manage Skills"].forEach(option => {
                let button = document.createElement("button");
                button.innerText = option;
                button.onclick = function() { handleMainOption(option); };
                controls.appendChild(button);
                log('Added ' + option + ' option');
            });
        }

        function handleMainOption(option) {
            log('Selected option: ' + option);
            if (option === "Manage Skills") {
                updateSkillControls();
            }
            // Add more options (e.g., Train) later
        }

        function updateSkillControls() {
            let controls = document.getElementById("skill-controls");
            controls.innerHTML = "";
            if (game.gameState === "main") {
                game.player.skillInventory.forEach(skill => {
                    let button = document.createElement("button");
                    button.innerText = `Add ${skill} to Active`;
                    button.onclick = function() { moveToActiveSkills(skill); };
                    controls.appendChild(button);
                    log(`Added button to move ${skill} to active skills`);
                });
                game.player.skills.forEach(skill => {
                    let button = document.createElement("button");
                    button.innerText = `Move ${skill} to Inventory`;
                    button.onclick = function() { moveToInventory(skill); };
                    controls.appendChild(button);
                    log(`Added button to move ${skill} to inventory`);
                });
            }
        }

        function moveToActiveSkills(skill) {
            if (game.player.skills.length < 10) {
                game.player.skills.push(skill);
                game.player.skillInventory = game.player.skillInventory.filter(s => s !== skill);
                log(`${skill} moved to active skills!`);
                document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
                updateSkillControls();
            } else {
                log('Active skills limit reached (10)!');
            }
        }

        function moveToInventory(skill) {
            game.player.skillInventory.push(skill);
            game.player.skills = game.player.skills.filter(s => s !== skill);
            log(`${skill} moved to inventory!`);
            document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
            updateSkillControls();
        }
    </script>
</body>
</html>
