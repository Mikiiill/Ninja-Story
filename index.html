<!DOCTYPE html>
<html>
<head>
    <title>ShinobiWay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background-color: #1a1a1a; color: #e0e0e0; font-family: Arial, sans-serif; }
        button { background-color: #ff4500; color: #fff; padding: 5px 10px; margin: 5px; border: none; cursor: pointer; }
        button:hover { background-color: #ff6347; }
        #log { height: 100px; overflow-y: auto; background-color: #2f2f2f; padding: 5px; }
        #output { padding: 5px; }
        .battle-ready { color: #00ff00; }
        .genin { color: #ffd700; }
    </style>
</head>
<body>
    <div id="player-status">Shinobi [HP: <span class="player-hp">10/10</span>]</div>
    <div id="enemy-status">Enemy [HP: 0/0</span>]</div>
    <div id="skill-count">Skill cards: 0 | Gold: 0</div>
    <div id="output">Welcome to ShinobiWay!</div>
    <div id="start-controls">
        <button id="start-button" onclick="startGame()">Start Game</button>
    </div>
    <div id="style-controls"></div>
    <div id="jutsu-controls"></div>
    <div id="skill-controls"></div>
    <div id="main-controls"></div>
    <div id="log">Log started...</div>

    <script>
        let game = {
            player: { name: "Shinobi", hp: 10, maxHp: 10, skills: [], skillInventory: [], gold: 0, rank: "Student", styles: [], skillCounts: { "Fire Jutsu": 0, "Shock Field Jutsu": 0, "Fireball Jutsu": 0, "Flame Throw Jutsu": 0, "Rock Barrier Jutsu": 0, "Demon Mind Jutsu": 0, "Shadow Clone Jutsu": 0, "Bite": 0, "Barrage": 0, "Rock Smash Jutsu": 0 } },
            gameState: "start",
            skillRanks: {
                "Shock Field Jutsu": "C-Rank", "Fireball Jutsu": "C-Rank", "Flame Throw Jutsu": "C-Rank",
                "Rock Barrier Jutsu": "C-Rank", "Demon Mind Jutsu": "C-Rank", "Shadow Clone Jutsu": "C-Rank",
                "Bite": "C-Rank", "Barrage": "C-Rank", "Rock Smash Jutsu": "C-Rank"
            },
            goldValues: { "D-Rank": 5, "C-Rank": 10, "B-Rank": 50, "A-Rank": 100, "S-Rank": 500 },
            asciiArt: {
                battleStart: "üëäüí• BATTLE BEGINS! üëäüí•\nShinobi vs. Enemy!",
                "Shock Field Jutsu": "‚ö°Ô∏è Shock Field!",
                "Fireball Jutsu": "üî• Fireball Strike!",
                "Flame Throw Jutsu": "üî•üî• Flame Burst!",
                "Rock Barrier Jutsu": "ü™® Rock Shield!",
                "Demon Mind Jutsu": "üíÄ Doom Strikes!",
                "Shadow Clone Jutsu": "üå´Ô∏è Clone Appears!",
                "Bite": "üò° Savage Bite!",
                "Barrage": "üí• Rapid Assault!",
                "Rock Smash Jutsu": "ü™®üí• Rock Smash!"
            },
            dotEffects: {
                "Flame Throw Jutsu": { baseDamage: 2, duration: 3 },
                "Demon Mind Jutsu": { baseDamage: 1, duration: 5 }
            },
            jutsuRequirements: {
                "Shock Field Jutsu": { styles: ["Lightning"] },
                "Fireball Jutsu": { styles: ["Fire"] },
                "Flame Throw Jutsu": { styles: ["Fire"] },
                "Rock Barrier Jutsu": { styles: ["Earth"] },
                "Demon Mind Jutsu": { styles: ["Illusion"] },
                "Shadow Clone Jutsu": { styles: ["Illusion"] },
                "Bite": { styles: ["Feral"] },
                "Barrage": { styles: ["Earth"] },
                "Rock Smash Jutsu": { styles: ["Earth"] }
            },
            rankLimits: { "Student": 5, "Genin": 10, "Chunin": 15, "Jonin": 20, "Kage": 25 }
        };

        function log(msg) {
            const el = document.getElementById('log');
            el.innerHTML += '<br>' + msg;
        }

        function startGame() {
            log('Starting game at ' + new Date().toLocaleTimeString() + '...');
            if (game.gameState === "start") {
                game.output = ["Train to earn gold and skills! Aim for 10 skills to become a Genin!"];
                document.getElementById("output").innerHTML = game.output.join("<br>");
                game.gameState = "chooseStyles";
                log('Setting up style selection...');
                setupStyleButtons();
                document.getElementById("start-button").style.display = "none";
            } else {
                log('Game already started, state: ' + game.gameState);
            }
        }

        function setupStyleButtons() {
            let controls = document.getElementById("style-controls");
            controls.innerHTML = "";
            let remainingStyles = ["Fire", "Illusion", "Earth", "Lightning", "Feral"].filter(s => !game.player.styles.includes(s));
            if (remainingStyles.length > 0) {
                remainingStyles.slice(0, 2).forEach(style => {
                    let button = document.createElement("button");
                    button.innerText = style;
                    button.onclick = function() { selectStyle(style); };
                    controls.appendChild(button);
                    log('Added ' + style + ' button');
                });
            } else {
                log('No styles left to choose.');
                game.player.styles.forEach(style => {
                    Object.keys(game.jutsuRequirements).forEach(jutsu => {
                        if (game.jutsuRequirements[jutsu].styles.includes(style)) {
                            game.skillRanks[jutsu] = "C-Rank";
                        }
                    });
                });
                setupJutsuSelection();
            }
        }

        function selectStyle(style) {
            log('Selecting ' + style + '...');
            if (game.player.styles.length < 2 && game.gameState === "chooseStyles") {
                game.player.styles.push(style);
                log(style + ' added as a style!');
                setupStyleButtons();
                if (game.player.styles.length === 2) {
                    log('Both styles selected, proceeding to jutsu selection...');
                    document.getElementById("style-controls").innerHTML = "";
                }
            } else {
                log('Style selection invalid or complete, state: ' + game.gameState);
            }
        }

        function setupJutsuSelection() {
            game.gameState = "chooseJutsu";
            let controls = document.getElementById("jutsu-controls");
            controls.innerHTML = "";
            let availableJutsu = Object.keys(game.jutsuRequirements).filter(jutsu => 
                game.jutsuRequirements[jutsu].styles.some(s => game.player.styles.includes(s))
            );
            let randomJutsu = [];
            for (let i = 0; i < 4 && availableJutsu.length > 0; i++) {
                let index = Math.floor(Math.random() * availableJutsu.length);
                randomJutsu.push(availableJutsu.splice(index, 1)[0]);
            }
            if (randomJutsu.length > 0) {
                randomJutsu.forEach(jutsu => {
                    let button = document.createElement("button");
                    button.innerText = jutsu;
                    button.onclick = function() { selectJutsu(jutsu); };
                    controls.appendChild(button);
                    log('Added ' + jutsu + ' to selection');
                });
            } else {
                log('No jutsu available based on styles.');
                showMainScreen();
            }
        }

        function selectJutsu(jutsu) {
            log('Selecting ' + jutsu + '...');
            if (game.gameState === "chooseJutsu") {
                game.player.skills.push(jutsu);
                game.player.skillCounts[jutsu]++;
                log(jutsu + ' added to skills!');
                document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
                document.getElementById("jutsu-controls").innerHTML = "";
                if (game.player.skills.length < 3) {
                    setupJutsuSelection();
                } else {
                    log('Three jutsu selected, returning to main screen...');
                    showMainScreen();
                }
            }
        }

        function showMainScreen() {
            game.gameState = "main";
            let controls = document.getElementById("main-controls");
            controls.innerHTML = "";
            ["Train", "Manage Skills"].forEach(option => {
                let button = document.createElement("button");
                button.innerText = option;
                button.onclick = function() { handleMainOption(option); };
                controls.appendChild(button);
                log('Added ' + option + ' option');
            });
        }

        function handleMainOption(option) {
            log('Selected option: ' + option);
            if (option === "Manage Skills") {
                updateSkillControls();
            }
        }

        function updateSkillControls() {
            let controls = document.getElementById("skill-controls");
            controls.innerHTML = "";
            if (game.gameState === "main") {
                for (let skill in game.player.skillCounts) {
                    for (let i = 0; i < game.player.skillCounts[skill]; i++) {
                        let button = document.createElement("button");
                        button.innerText = `Move ${skill} (${i + 1}) to Inventory`;
                        button.onclick = function() { moveToInventory(skill, i); };
                        controls.appendChild(button);
                        log(`Added button to move ${skill} (${i + 1}) to inventory`);
                    }
                }
                game.player.skillInventory.forEach((skill, index) => {
                    let button = document.createElement("button");
                    button.innerText = `Add ${skill} (${index + 1}) to Active`;
                    button.onclick = function() { moveToActiveSkills(skill, index); };
                    controls.appendChild(button);
                    log(`Added button to move ${skill} (${index + 1}) to active skills`);
                });
            }
        }

        function moveToActiveSkills(skill, index) {
            if (game.player.skills.length < game.rankLimits[game.player.rank]) {
                game.player.skills.push(skill);
                game.player.skillCounts[skill]++;
                game.player.skillInventory.splice(index, 1);
                log(`${skill} moved to active skills!`);
                document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
                updateSkillControls();
            } else {
                log('Active skills limit reached!');
            }
        }

        function moveToInventory(skill, countIndex) {
            game.player.skillInventory.push(skill);
            game.player.skillCounts[skill]--;
            if (game.player.skillCounts[skill] <= 0) {
                game.player.skills = game.player.skills.filter(s => s !== skill);
            }
            log(`${skill} moved to inventory!`);
            document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
            updateSkillControls();
        }
    </script>
</body>
</html>
