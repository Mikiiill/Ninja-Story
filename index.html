<!DOCTYPE html>
<html>
<head>
    <title>ShinobiWay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background-color: #1a1a1a; color: #e0e0e0; font-family: Arial, sans-serif; }
        button { background-color: #ff4500; color: #fff; padding: 5px 10px; margin: 5px; border: none; cursor: pointer; }
        button:hover { background-color: #ff6347; }
        #log { height: 100px; overflow-y: auto; background-color: #2f2f2f; padding: 5px; }
        #output { padding: 5px; }
        .battle-ready { color: #00ff00; }
        .genin { color: #ffd700; }
    </style>
</head>
<body>
    <div id="player-status">Shinobi [HP: <span class="player-hp">10/10</span>]</div>
    <div id="enemy-status">Enemy [HP: <span class="enemy-hp">0/0</span>]</div>
    <div id="skill-count">Skill cards: 0 | Gold: 0</div>
    <div id="output">Welcome to ShinobiWay!</div>
    <div id="start-controls">
        <button id="start-button" onclick="startGame()">Start Game</button>
    </div>
    <div id="style-controls"></div>
    <div id="skill-controls"></div> <!-- New div for skill management -->
    <div id="log">Log started...</div>

    <script>
        let game = {
            player: { name: "Shinobi", hp: 10, maxHp: 10, skills: [], skillInventory: [], gold: 0, rank: "Student" },
            gameState: "start",
            skillRanks: {
                "Fire": "D-Rank", "Illusion": "D-Rank", "Earth": "D-Rank", "Lightning": "D-Rank", "Feral": "D-Rank"
            },
            goldValues: { "D-Rank": 5, "C-Rank": 10, "B-Rank": 50, "A-Rank": 100, "S-Rank": 500 },
            asciiArt: {
                battleStart: "üëäüí• BATTLE BEGINS! üëäüí•\nShinobi vs. Enemy!",
                fire: "üî• Fire Strike!",
                illusion: "üå´Ô∏è Illusion Cast!",
                shockField: "‚ö°Ô∏è Shock Field!",
                doom: "üíÄ Doom Strikes!"
            }
        };

        function log(msg) {
            const el = document.getElementById('log');
            el.innerHTML += '<br>' + msg;
        }

        function startGame() {
            log('Starting game at ' + new Date().toLocaleTimeString() + '...');
            if (game.gameState === "start") {
                game.output = ["Train to earn gold and skills! Aim for 10 skills to become a Genin!"];
                document.getElementById("output").innerHTML = game.output.join("<br>");
                game.gameState = "chooseStyles";
                log('Setting up style selection...');
                setupStyleButtons();
                document.getElementById("start-button").style.display = "none";
            } else {
                log('Game already started, state: ' + game.gameState);
            }
        }

        function setupStyleButtons() {
            let controls = document.getElementById("style-controls");
            controls.innerHTML = "";
            let remainingStyles = ["Fire", "Illusion"].filter(s => !game.player.skills.includes(s));
            if (remainingStyles.length > 0) {
                remainingStyles.forEach(style => {
                    let button = document.createElement("button");
                    button.innerText = style;
                    button.onclick = function() { selectStyle(style); };
                    controls.appendChild(button);
                    log('Added ' + style + ' button');
                });
            } else {
                log('No styles left to choose.');
                updateSkillControls();
            }
        }

        function selectStyle(style) {
            log('Selecting ' + style + '...');
            if (game.player.skills.length < 10 && game.gameState === "chooseStyles") {
                let count = game.player.skills.filter(s => s === style).length;
                if (count < 4) {
                    game.player.skills.push(style);
                    log(style + ' added to skills!');
                    document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
                    setupStyleButtons();
                } else if (count === 4) {
                    game.player.skills = game.player.skills.filter(s => s !== style); // Remove 4th copy
                    let rank = game.skillRanks[style] || "D-Rank";
                    let goldGain = game.goldValues[rank];
                    game.player.gold += goldGain;
                    log(`5th ${style} converted to ${goldGain} gold!`);
                    document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
                    setupStyleButtons();
                }
                if (game.player.skills.length === 2) {
                    log('Both styles selected, ready to play!');
                    game.gameState = "battle";
                    document.getElementById("output").innerHTML += `<br><span class="battle-ready">Battle ready!</span><br>${game.asciiArt.battleStart}`;
                    document.getElementById("style-controls").innerHTML = "";
                }
                if (game.player.skills.length === 10) {
                    game.player.rank = "Genin";
                    document.getElementById("output").innerHTML += `<br><span class="genin">Promoted to Genin!</span>`;
                    log('Promoted to Genin with 10 skill cards!');
                }
            } else {
                log('Selection invalid or complete, state: ' + game.gameState);
            }
        }

        function updateSkillControls() {
            let controls = document.getElementById("skill-controls");
            controls.innerHTML = "";
            if (game.gameState === "battle") {
                // Add active skills from inventory to controls
                game.player.skillInventory.forEach(skill => {
                    let button = document.createElement("button");
                    button.innerText = `Add ${skill} to Active`;
                    button.onclick = function() { moveToActiveSkills(skill); };
                    controls.appendChild(button);
                    log(`Added button to move ${skill} to active skills`);
                });
                // Add buttons to move active skills back to inventory
                game.player.skills.forEach(skill => {
                    let button = document.createElement("button");
                    button.innerText = `Move ${skill} to Inventory`;
                    button.onclick = function() { moveToInventory(skill); };
                    controls.appendChild(button);
                    log(`Added button to move ${skill} to inventory`);
                });
            }
        }

        function moveToActiveSkills(skill) {
            if (game.player.skills.length < 10) {
                game.player.skills.push(skill);
                game.player.skillInventory = game.player.skillInventory.filter(s => s !== skill);
                log(`${skill} moved to active skills!`);
                document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
                updateSkillControls();
            } else {
                log('Active skills limit reached (10)!');
            }
        }

        function moveToInventory(skill) {
            game.player.skillInventory.push(skill);
            game.player.skills = game.player.skills.filter(s => s !== skill);
            log(`${skill} moved to inventory!`);
            document.getElementById("skill-count").innerText = `Skill cards: ${game.player.skills.length} | Gold: ${game.player.gold}`;
            updateSkillControls();
        }
    </script>
</body>
</html>
