<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShinobiWay</title>
    <style>
        body {
            background-color: #f0f0f0 !important; /* Force background to prevent black/white */
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
        }
        #player-hp, #enemy-hp {
            display: block;
            margin: 5px 0;
        }
        #battle-log {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 5px;
            margin: 10px 0;
        }
        #main-controls, #skill-controls, #travel-controls {
            margin: 10px 0;
        }
        button {
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }
        .battle-ready { color: green; font-weight: bold; }
        .output-text-player { color: blue; }
        .output-text-enemy { color: red; }
        .output-text-neutral { color: black; }
        .status-burn { color: orange; }
        .status-regen { color: green; }
    </style>
</head>
<body>
    <span id="player-hp">Shinobi [HP: 10/10]</span>
    <span id="enemy-hp">Training Dummy [HP: 10/10]</span>
    <div id="battle-log"></div>
    <div id="main-controls">
        <button id="start-game" onclick="startGame()">Start Game</button>
        <button id="train" onclick="startTrainingFight()">Train</button>
        <button id="travel" onclick="startTravelFight()">Travel</button>
    </div>
    <div id="skill-controls"></div>
    <div id="travel-controls" style="display: none;"></div>

    <script src="Characters.js"></script>
    <script src="Jutsu.js"></script>
    <script src="Log.js"></script>
    <script src="Map.js"></script>
    <script src="RANKUP.js"></script>
    <script src="Battle.js"></script>

    <script>
        let game = {
            gameState: "initial", // Explicitly set to initial to avoid "In Village" assumption
            player: null,
            enemy: null,
            user: null,
            target: null,
            battleScene: null,
            battleType: null
        };

        function initializeGame() {
            game.player = {
                name: "Shinobi",
                hp: 10,
                maxHp: 10,
                skills: [],
                skillInventory: [],
                statusEffects: [],
                ninjaStyles: {},
                lastVillage: "Newb Village",
                exp: 0,
                maxExp: 10
            };
            game.player = new Proxy(game.player, {
                set(target, property, value) {
                    if (property === "hp" && target[property] !== value) {
                        target[property] = value;
                        updateStatus();
                    } else {
                        target[property] = value;
                    }
                    return true;
                }
            });
            game.enemy = null;
            addInitialBarrageCards();
            console.log("[DEBUG]: Game initialized", game.player);
        }

        function addInitialBarrageCards() {
            let skillSet = new Skills();
            if (skillSet) {
                game.player.skillInventory = [skillSet.findSkill("Barrage"), skillSet.findSkill("Barrage")]; // Exactly 2 Barrage cards
            } else {
                console.error("[ERROR]: Skills class not loaded for initial barrage cards");
            }
        }

        function startGame() {
            if (game.gameState === "initial" || game.gameState === "In Village") {
                initializeGame();
                game.gameState = "chooseStyles"; // Trigger style selection (handled by RANKUP.js)
                console.log("[DEBUG]: Game started, state set to chooseStyles");
                // Assume RANKUP.js handles further flow
                let controls = document.getElementById("main-controls");
                if (controls) controls.style.display = "block"; // Ensure controls are visible
            } else {
                console.log("[DEBUG]: Game already started, state:", game.gameState);
            }
        }

        // Placeholder for updateStatus (defined in Battle.js)
        function updateStatus() {
            // This will be overridden by Battle.js
        }
    </script>
</body>
</html>
