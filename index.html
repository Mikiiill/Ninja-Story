<!DOCTYPE html>
<html>
<head>
    <title>ShinobiWay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background-image: url('https://mikiiill.github.io/ShinobiWay/Back.png');
            background-repeat: no-repeat;
            background-size: cover;
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .output {
            width: 80%;
            height: 300px;
            background-color: #333;
            overflow-y: auto;
            padding: 10px;
            margin: 10px;
            border: 2px solid #fff;
        }
        .controls {
            width: 80%;
            margin: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .status {
            width: 80%;
            margin: 10px;
            padding: 10px;
            border: 2px solid #fff;
        }
        button {
            background-color: #555;
            color: #fff;
            border: 2px solid #fff;
            padding: 5px 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #777;
        }
        .fire {
            background-color: #800000;
        }
        .lightning {
            background-color: #ff4500;
        }
        .illusion {
            background-color: #800080;
        }
        .earth {
            background-color: #3c2f2f;
        }
        .feral {
            background-color: #228b22;
        }
        .neutral {
            background-color: #555;
        }
        .water {
            background-color: #000080;
        }
        .wind {
            background-color: #d4a017;
        }
        .start-button {
            background-color: #555;
            color: #fff;
            border: 2px solid #fff;
            font-size: 1.5rem;
            padding: 10px 20px;
        }
        .skills-button, .train-button {
            background-color: #555;
            color: #fff;
            border: 2px solid #fff;
            font-size: 1.2rem;
            padding: 5px 10px;
        }
        .output-text-player {
            color: #00ff00;
        }
        .output-text-enemy {
            color: #ff00ff;
        }
        .output-text-neutral {
            color: #ccc;
        }
        .status-burn {
            color: #800000;
        }
        .status-numb {
            color: #ff4500;
        }
        .status-bleed {
            color: #ff00ff;
        }
        .status-healing {
            color: #00ff00;
        }
        .status-doom {
            color: #ffffff;
        }
        .status-shadowcloneeffect {
            color: #800080;
        }
        .status-substitution {
            color: #3c2f2f;
        }
        .status-rockbarrier {
            color: #228b22;
        }
        .sprite {
            width: 50px;
            height: 50px;
            vertical-align: middle;
        }
        .player-hp {
            color: #00ff00;
        }
        .enemy-hp {
            color: #ff00ff;
        }
        .skills-popup {
            background: #333;
            color: #fff;
            padding: 20px;
            border: 2px solid #fff;
        }
        .close-button {
            background: #555;
            color: #fff;
            border: 2px solid #fff;
            font-size: 1.2rem;
            padding: 5px 10px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="status" id="player-status">Shinobi [HP: <span class="player-hp">10/10</span>] [Gold: <span id="gold-amount">0</span>]</div>
    <div class="status" id="enemy-status">Enemy [HP: <span class="enemy-hp">0/0</span>]</div>
    <div class="output" id="output">Welcome to ShinobiWay!</div>
    <div class="controls" id="start-controls">
        <button class="start-button" onclick="startGame()">Start Game</button>
    </div>
    <div class="controls" id="style-controls"></div>
    <div class="controls" id="jutsu-controls"></div>
    <div class="controls" id="skill-controls"></div>
    <div class="controls" id="main-controls"></div>
    <div class="output" id="log">Log started...</div>

    <script>
        let game = {
            player: {
                name: "Shinobi",
                hp: 10,
                maxHp: 10,
                Rank: "Student",
                ninjaStyles: { Ninjutsu: "D-Rank", Taijutsu: "D-Rank", Genjutsu: "D-Rank", Fire: "D-Rank", Lightning: "D-Rank", Earth: "D-Rank", Water: "D-Rank", Wind: "D-Rank", Feral: "D-Rank" },
                skills: [],
                skillInventory: [],
                statusEffects: []
            },
            enemy: null,
            battleNum: 1,
            output: [],
            gameState: "start",
            battleScene: null,
            outputQueue: [],
            isOutputting: false,
            gold: 0
        };

        class StatusEffect {
            constructor(name, duration, damage = 0) {
                this.name = name;
                this.duration = duration;
                this.damage = damage;
                this.new = true;
            }
        }

        class BattleSkill {
            constructor(name, attributes, requirements, skillFunction, style, support, rank) {
                this.name = name;
                this.attributes = attributes || [];
                this.requirements = requirements || {};
                this.skillFunction = skillFunction;
                this.style = style;
                this.support = support || false;
                this.rank = rank;
            }
        }

        class Mob {
            constructor(name, hp, maxHp, Rank, ninjaStyles, skills, statusEffects, sprite) {
                this.name = name;
                this.hp = hp;
                this.maxHp = maxHp;
                this.Rank = Rank;
                this.ninjaStyles = ninjaStyles;
                this.skills = skills;
                this.statusEffects = statusEffects || [];
                this.sprite = sprite;
            }
        }

        class Skills {
            constructor() {
                this.skills = [];
                this.initializeSkills();
            }

            initializeSkills() {
                this.skills = [
                    new BattleSkill("Barrage", ["Taijutsu"], {}, this.barrage.bind(this), "neutral", false, "D-Rank"),
                    new BattleSkill("Substitution Jutsu", [], { Ninjutsu: "D-Rank", Taijutsu: "D-Rank" }, this.substitutionJutsu.bind(this), "neutral", true, "D-Rank"),
                    new BattleSkill("Double Image", ["Genjutsu"], {}, this.doubleImage.bind(this), "illusion", true, "D-Rank"),
                    new BattleSkill("Shadow Clone Jutsu", ["Ninjutsu"], { Ninjutsu: "C-Rank" }, this.shadowCloneJutsu.bind(this), "neutral", true, "C-Rank"),
                    new BattleSkill("Demonic Vision", ["Genjutsu"], { Genjutsu: "C-Rank" }, this.demonicVision.bind(this), "illusion", false, "C-Rank"),
                    new BattleSkill("Healing Stance", ["Ninjutsu"], {}, this.healingStance.bind(this), "neutral", true, "D-Rank"),
                    new BattleSkill("Earth Dome Jutsu", ["Earth", "Ninjutsu"], { Earth: "C-Rank" }, this.earthDomeJutsu.bind(this), "earth", true, "C-Rank"),
                    new BattleSkill("Flame Throw Jutsu", ["Fire", "Ninjutsu"], { Fire: "C-Rank", Ninjutsu: "C-Rank" }, this.flameThrowJutsu.bind(this), "fire", false, "B-Rank"),
                    new BattleSkill("Static Field Jutsu", ["Lightning", "Ninjutsu"], { Lightning: "C-Rank" }, this.staticFieldJutsu.bind(this), "lightning", false, "C-Rank"),
                    new BattleSkill("Fireball Jutsu", ["Fire", "Ninjutsu"], { Fire: "C-Rank" }, this.fireballJutsu.bind(this), "fire", false, "C-Rank"),
                    new BattleSkill("Dynamic Entry", ["Taijutsu"], { Taijutsu: "C-Rank" }, this.dynamicEntry.bind(this), "neutral", false, "C-Rank"),
                    new BattleSkill("Falcon Drop", ["Taijutsu"], { Taijutsu: "B-Rank" }, this.falconDrop.bind(this), "neutral", false, "B-Rank"),
                    new BattleSkill("Rock Smash Jutsu", ["Earth", "Taijutsu"], { Earth: "B-Rank" }, this.rockSmashJutsu.bind(this), "earth", false, "B-Rank"),
                    new BattleSkill("Genjutsu Release", ["Genjutsu"], { Genjutsu: "B-Rank" }, this.genjutsuRelease.bind(this), "illusion", true, "B-Rank"),
                    new BattleSkill("Lightning Edge", ["Lightning", "Ninjutsu"], { Lightning: "C-Rank", Ninjutsu: "C-Rank" }, this.lightningEdge.bind(this), "lightning", false, "B-Rank")
                ];
            }

            canUseSkill(mob, skill) {
                return Object.keys(skill.requirements).every(key => mob.ninjaStyles[key] && compareRanks(mob.ninjaStyles[key], skill.requirements[key]) >= 0);
            }

            findSkill(name) {
                return this.skills.find(skill => skill.name === name);
            }

            barrage(user, target, scene) {
                let baseDamage = Math.floor(Math.random() * 2) + 1; // 1-2 damage
                let comboDamage = Math.floor(Math.random() * 2) + 1; // 1-2 damage
                target.hp = Math.max(0, Math.min(target.maxHp, target.hp - baseDamage));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> attacks <span class="output-text-${target === game.player ? 'player' : 'enemy'}">${target.name}</span> with <span class="output-text-neutral">Barrage</span> and hits for ${baseDamage} damage!`);
                if (target.hp > 0) {
                    target.hp = Math.max(0, Math.min(target.maxHp, target.hp - comboDamage));
                    scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> combos ${target.name} for ${comboDamage} damage!`);
                }
                if (target.hp <= 0) return true;
                return false;
            }

            substitutionJutsu(user, target, scene) {
                user.statusEffects.push(new StatusEffect("Swap", 1));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> prepares <span class="output-text-neutral">Substitution Jutsu</span> <span class="status-substitution">ü™µ</span>!`);
                return true;
            }

            doubleImage(user, target, scene) {
                user.statusEffects.push(new StatusEffect("DoubleImage", 1));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> creates <span class="output-text-illusion">Double Image</span> <span class="status-substitution">üå´Ô∏è</span>!`);
                return true;
            }

            shadowCloneJutsu(user, target, scene) {
                if (user.hp < 2) {
                    scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> does not have enough HP to cast <span class="output-text-neutral">Shadow Clone Jutsu</span>!`);
                    return false;
                }
                let cloneCount = user.statusEffects.filter(e => e.name === "ShadowCloneEffect").length;
                if (cloneCount >= 3) {
                    scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> already has the maximum of 3 shadow clones!`);
                    return false;
                }
                user.hp = Math.max(0, Math.min(user.maxHp, user.hp - 2));
                user.statusEffects.push(new StatusEffect("ShadowCloneEffect", 3));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> casts <span class="output-text-neutral">Shadow Clone Jutsu</span>, adding a clone <span class="status-shadowcloneeffect">üë•</span>!`);
                return true;
            }

            demonicVision(user, target, scene) {
                let damage = 1;
                target.hp = Math.max(0, Math.min(target.maxHp, target.hp - damage));
                target.statusEffects.push(new StatusEffect("Doom", 5, 1));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> casts <span class="output-text-illusion">Demonic Vision</span> on <span class="output-text-${target === game.player ? 'player' : 'enemy'}">${target.name}</span> for ${damage} damage, inflicting <span class="status-doom">Doom üíÄ</span>!`);
                if (target.hp <= 0) return true;
                return false;
            }

            healingStance(user, target, scene) {
                let heal = user.hp < user.maxHp ? 1 : 0;
                user.hp = Math.max(0, Math.min(user.maxHp, user.hp + heal));
                user.statusEffects.push(new StatusEffect("Healing", 3, 1));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> enters <span class="output-text-neutral">Healing Stance</span>${heal > 0 ? `, healing ${heal} HP` : ""} <span class="status-healing">üåø</span>!`);
                return true;
            }

            earthDomeJutsu(user, target, scene) {
                user.statusEffects.push(new StatusEffect("Dome", 2));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> raises <span class="output-text-earth">Earth Dome Jutsu</span> <span class="status-rockbarrier">ü™®</span>!`);
                return true;
            }

            flameThrowJutsu(user, target, scene) {
                let damage = Math.floor(Math.random() * 2) + 4; // 4-5 damage
                target.hp = Math.max(0, Math.min(target.maxHp, target.hp - damage));
                target.statusEffects.push(new StatusEffect("Burn", 1, 2));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> casts <span class="output-text-fire">Flame Throw Jutsu</span> on <span class="output-text-${target === game.player ? 'player' : 'enemy'}">${target.name}</span> for ${damage} damage, inflicting <span class="status-burn">Burn üî•</span>!`);
                if (target.hp <= 0) return true;
                return false;
            }

            staticFieldJutsu(user, target, scene) {
                let damage = Math.floor(Math.random() * 2) + 2; // 2-3 damage
                target.hp = Math.max(0, Math.min(target.maxHp, target.hp - damage));
                user.statusEffects.push(new StatusEffect("Numb", 1));
                target.statusEffects.push(new StatusEffect("Numb", 1));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> uses <span class="output-text-lightning">Static Field Jutsu</span> on <span class="output-text-${target === game.player ? 'player' : 'enemy'}">${target.name}</span> for ${damage} damage, inflicting <span class="status-numb">Numb ‚ö°Ô∏è</span> on both!`);
                if (target.hp <= 0) return true;
                return false;
            }

            fireballJutsu(user, target, scene) {
                let damage = Math.floor(Math.random() * 2) + 3; // 3-4 damage
                target.hp = Math.max(0, Math.min(target.maxHp, target.hp - damage));
                target.statusEffects.push(new StatusEffect("Burn", 1, 1));
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> casts <span class="output-text-fire">Fireball Jutsu</span> on <span class="output-text-${target === game.player ? 'player' : 'enemy'}">${target.name}</span> for ${damage} damage, inflicting <span class="status-burn">Burn üî•</span>!`);
                if (target.hp <= 0) return true;
                return false;
            }

            dynamicEntry(user, target, scene) {
                let damage = 1;
                target.hp = Math.max(0, Math.min(target.maxHp, target.hp - damage));
                let usableSkills = user.skills.filter(skill => !skill.support && skill !== this.findSkill("Dynamic Entry"));
                let nextSkill = usableSkills.length > 0 ? usableSkills[Math.floor(Math.random() * usableSkills.length)] : null;
                scene.queueOutput(`<span class="output-text-${user === game.player ? 'player' : 'enemy'}">${user.name}</span> uses <span class="output-text-neutral">Dynamic Entry</span> on <span class="output-text-${target === game.player ? 'player' : 'enemy'}">${target.name}</span> for ${damage} damage!`);
                if (nextSkill) nextSkill.skillFunction(user, target, scene);
                return target.hp <= 0;
            }

            falconDrop(user, target, scene) {
                let damage = 2;
                user.hp = Math.max(0, Math.min(user.maxHp, user.hp - 2));
                target.hp = Math.max(0, Math.min(target.maxHp, target.hp - damage));
                target.statusEffects.push(new StatusEffect("Numb", 1));
                user.statusEffects.push(new StatusEffect("READY", 1));
                scene.queueOutput
